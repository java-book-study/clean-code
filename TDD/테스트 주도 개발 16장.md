# 16장. 드디어, 추상화

``` java
//TODO
$5 + $5에서 Money 반환하기
Sum.plus
Expression.times
```

Sum.plus()를 제대로 구현하지 않았으니, Sum.plus의 테스트를 작성하고 구현해보자.

``` java
@Test
void testSumPlusMoney() {
    Expression fiveBucks = Money.dollar(5);
    Expression tenFrancs = Money.franc(10);
    Bank bank = new Bank();
    bank.addRate("CHF", "USD", 2);
    Expression sum = new Sum(fiveBucks, tenFrancs).plus(fiveBucks);
    Money result = bank.reduce(sum, "USD");
    assertEquals(Money.dollar(15), result);
}
```

###### Sum
```java
@Override
public Expression plus(Expression addend) { return new Sum(this, addend); }
```

테스트가 코드보다 더 길고, 코드는 Money.plus와 동일한 코드다.

TDD 구현시, 테스트 코드의 줄 수와 모델 코드의 줄 수가 거의 비슷하게 끝난다.  
TDD가 경제적이기 위해선 코드의 줄 수가 두배가 되거나, 동일한 기능을 구현하되 (테스트의)절반의 줄 수로 해야한다.  

``` java
$5 + $5에서 Money 반환하기
Expression.times
```

Money.times()는 이미 작성했으니 Sum.times()가 작동하게 만든다면 Expression.times()를 선언하는 일은 쉽다.

``` java
@Test
void testSumTimes() {
    Expression fiveBucks = Money.dollar(5);
    Expression tenFrancs = Money.franc(10);
    Bank bank = new Bank();
    bank.addRate("CHF", "USD", 2);
    Expression sum = new Sum(fiveBucks, tenFrancs).times(2);
    Money result = bank.reduce(sum, "USD");
    assertEquals(Money.dollar(20), result);
}
```

###### Sum
``` java
public Expression times(int multiplier) {
    return new Sum(augend.times(multiplier), addend.times(multiplier));
}
```

###### Expression
```
Expression times(int multiplier);
```

이제 모든 테스트는 깔끔하게 통과한다. 

``` java
$5 + $5에서 Money 반환하기
```

``` java
@Test
void testPlusSameCurrencyReturnsMoney() {
    Expression sum = Money.dollar(1).plus(Money.dollar(1));
    // assertTrue(sum instanceof Money);
    assertTrue(sum instanceof Sum);
}
```

이 테스트는 깔끔하게 성공할 수 있는 방법이 없다.  
따라서, 이 테스트는 실패했고 책에서는 테스트를 삭제하고 떠난다. ?????????

- 미래에 코드를 읽을 다른 사람들을 염두에 둔 테스트를 작성했다.
- TDD와 여러분의 현재 개발 스타일을 비교해 볼 수 있는 실험 방법을 제시했다.
- 또 한 번 선언부에 대한 수정이 시스템 나머지 부분으로 번져갔고, 문제를 고치기 위해 역시 컴파일러의 조언을 따랐다.
- 잠시 실험을 시도했는데, 제대로 되지 않아서 버렸다.