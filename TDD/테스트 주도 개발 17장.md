# 17장. Money 회고

## 다음에 할 일은 무엇인가
1. 아직 Sum.plus()와 Money.plus() 사이에 지저분한 중복이 남았다. Expression을 인터페이스 대신 클래스로 바꾼다면, 공통되는 코드를 담아낼 수 있는 적절한 곳이 될 수 있다.

2. SmallLint, SonarQube, SonarLint와 같은 코드 감정 프로그램을 실행하라.  
코드 감정 프로그램을 맹신할 필요는 없지만, 쓸모 없는 코드를 지우기 위한 방법으로 매우 유용하다.

3. '다음에 할일은 무엇인가?'와 관련된 질문은 '어떤 테스트들이 추가로 더 필요할까?'로 바꿔 생각해보자. 

4. 할 일 목록이 빌 때가 그때까지 설계한 것을 검토하기에 적절한 시기이다. 
    - 말과 개념이 서로 잘 통하는지, 현재의 설계로 제거하기 힘든 중복이 있는지 확인하라.

## 메타포 - 설계 구조에 미치는 메타포의 엄청난 영향

> Money 예제를 코딩하면서 가장 놀라운 점은 이번 Money 예제의 결과가 기존에 했던 것과 많이 다르다는 것

책을 작성하며 기존에는 'expression(수식)' 메타포를 생각했는데, 설계가 기존과는 완전히 다른 방향으로 흘렀다.  
Expression 메타포는 중복되는 통화를 합치는 세세한 일단의 문제에서 해방되고, 코드도 명확해졌다.

## JUnit 사용도 - 언제 테스트를 실행했으며, JUnit을 어떻게 사용해 왔는가

대충 작가는 1분 이내에 테스트를 다시 돌리는 경우가 압도적으로 많았고, 테스트 간격이 큰 쪽은 글을 작성하느라 보낸 시간이라고 한다.  
즉, 초반에 주장했듯이 TDD의 한 사이클은 30초 ~ 1분 사이 정도라는걸 증명한 것.

## 코드 메트릭스(metrics) - 결과 코드의 수치화

||실제 코드|테스트 코드|
|---|---|---|
|클래스|5|1|
|함수 (1)|22|15|
|줄 (2)|91|89|
|회기성 복잡도 (3)|1.04|1|
|함수당 줄|4.1(4)|5.9(5)|

1. 코드와 테스트 사이에 대략 비슷한 양의 함수와 줄이 있다.
2. 모델 코드와 테스트 코드 사이의 대략적인 줄 수의 비율은 비슷하게 유지된다.
3. 회기성 복잡도는 기존의 흐름 복잡도와 같다. 반복문에나 분기가 없고, 명시적 흐름 제어 대신 다형성을 주로 사용하여 테스트나 실제 코드의 복잡도가 낮다.
4. 함수의 선언부와 닫는 괄호도 포함된 줄 수다.
5. 공통된 픽스처 구축 코드를 추출하지 않아 테스트의 함수당 줄 수가 과장되었다.

## 프로세스 - 빨/초/리팩토링 각 단계에서 얼마 만큼 작업해야 하는가

TDD의 주기
1. 작은 테스트를 추가한다.
2. 모든 테스트를 실행하고, 실패한다.
3. 코드에 변화를 준다.
4. 모든 테스트를 실행하고, 성공한다.
5. 중복을 제거한다.

## 테스트의 질 - 전통적인 테스트 메트릭스에 TDD 테스트가 어떻게 필적할 수 있는가

TDD의 부산물로 생기는 테스트들은 유용하다. 하지만, 이 테스트를 만능이라고 생각하지 말자.
TDD로 대체할 수 없는 대표적인 테스트들이다.
1. 성능 테스트
2. 스트레스 테스트
3. 사용성 테스트

널리 사용되는 테스트 지표
1. 명령문 커버리지는 테스트의 질에 대한 충분한 평가 기준이 될 수는 없지만, 테스트의 시작점이다.
모델 코드를 위해 작성한 것이 아닌 디버깅을 위한 코드는 제외한다.
2. 결함 삽입은 코드의 의미를 바꾼 후에 테스트가 실패하는지 보는 것이다.  
이 작업은 수동으로도 가능하지만, Jester 같은 툴을 사용할 수도 있다.

전체 커버리지 수치는 프로그램의 서로 다른 경우를 테스트하는 테스트 수를 테스팅이 필요한 경우의 수(로직의 복잡도)로 나눈것이다.  
테스트 커버리지를 향상시키는 한가지 방법은 더 많은 테스트를 작성하는 건데, 이와 반대로 프로그램의 로직을 단순화하는 방법도 있다.

테스트는 그대로 두고 코드를 줄여서 동일한 테스트가 다양한 경우를 다루게 하자.

## 최종 검토

1. 테스트를 확실하게 돌아가게 만드는 3가지 접근법
    1. 가짜로 구현하기
        - 상수를 반환하게 만들고 진짜 코드를 얻을 때까지 단계적으로 상수를 변수로 바꾸자.
        - 가짜로 구현하기는 DRY 법칙(중복의 4가지 법칙)에 위배되지만, 리팩토링 단계에서 제거될 것이다.
    2. 삼각측량법
        - 삼각측량은 어떤 한 점의 좌표와 거리를 삼각형의 성질을 이용하여 알아내는 방법이다
        - 간단하게 말해 2개를 통해 나머지 1개를 알아내는 것...
    3. 명백하게 구현하기
        - 실제 구현을 입력한다.

2. 설계를 주도하기 위한 방법으로 테스트 코드와 실제 코드 사이의 중복 제거
3. 테스트 사이의 간격을 조절할 수 있는 능력

```
참고) Don't Repeat Yourself(DRY), 중복 배제 원리
1. 강요된(impose) 중복. 개발자들은 다른 선택이 없다고 느낀다. 환경이 중복을 요구하는 것처럼 보인다.
2. 부주의한 중복. 개발자들은 자신들이 정보를 중복하고 있다는 것을 깨닫지 못한다.
3. 참을성 없는 중복. 중복이 쉬워 보이기 때문에 개발자들이 게을러져서 중복을 하게 된다.
4. 개발자간의 중복. 한 팀에 있는(혹은 다른 팀에 있는) 여러 사람들이 동일한 정보를 중복한다.
```