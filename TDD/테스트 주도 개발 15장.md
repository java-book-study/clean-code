# 15장. 서로 다른 통화 더하기

``` java
$5 + 10CHF = $10(환율이 2:1일 경우)
$5 + $5에서 Money 반환하기
```

이제 $5 + 10CHF에 대한 테스트를 추가할 준비가 되었다. 

``` java
@Test
void testMixedAddition() {
    Money fiveBucks = Money.dollar(5);
    Money tenFrancs = Money.franc(10);
    Bank bank = new Bank();
    bank.addRate("CHF", "USD", 2);
    Money result = bank.reduce(
            fiveBucks.plus(tenFrancs), "USD");
    assertEquals(Money.dollar(10), result);
}

Expected :10 USD
Actual   :15 USD
```

Sum.reduce()의 인자를 축약하면 테스트가 통과한다.

``` java
@Override
public Money reduce(Bank bank, String to) {
    int amount = augend.reduce(bank, to).amount + addend.reduce(bank, to).amount;
    return new Money(amount, to);
}
```

Sum의 멤버변수들은 이제 Expression으로 취급할 수 있으며, Money.plus와 Money.times의 인자 및 반환 타입도 Expression으로 변환할 수 있다.

이제, 테스트의 Money 타입들도 Expression으로 바꿔주자.
``` java
@Test
void testMixedAddition() {
    Expression fiveBucks = Money.dollar(5);
    Expression tenFrancs = Money.franc(10);
    Bank bank = new Bank();
    bank.addRate("CHF", "USD", 2);
    Money result = bank.reduce(
            fiveBucks.plus(tenFrancs), "USD");
    assertEquals(Money.dollar(10), result);
}
```

이제 컴파일러가 시키는 대로 빨간줄뜨는 곳들을 수정하고 테스트를 다시 돌려보면, 모든 테스트가 성공한다.

- 원하는 테스트를 작성하고, 한 단계에 달성할 수 있도록 뒤로 물렀다.
- 좀 더 추상적인 선언을 통해 가지에서 뿌리(애초의 테스트 케이스)로 일반화했다.
- 변경 후, 그 영향을 받은 다른 부분들을 변경하기 위해 컴파일러의 지시를 따랐다.
